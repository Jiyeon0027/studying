# openSSH & localhost

- 시스템을 원격에서 접속할 때 사용하는 서비스
- client 에서 ssh 원격접속

## Local port forwarding

- SSH-Client : 웹 서버로의 접근을 원하는 서버 혹은 Local PC
- SSH-Server : 접근할 웹 서버를 담고 있는 서버, 22번 포트가 열려 있다고 가정할 때 이것을 통해서 웹 서버에 접근한다
- Web server : SSH-Client가 접근을 원하는 웹 서버, Nginx 서버고 80번 포트에 바인딩 돼 있다고 가정

## localhost란?

내 pc에서 나 자신을 가르키는 주소

- 엄밀하게는 `localhost` 라는 글자 자체가 `OS`의 기본 로컬 라우팅 테이블에 부팅과 동시에 등재 → `localhost` 는 호스트명일 뿐이고, 실제로는 `IP주소`를 사용
- 고정적으로 `127.0.0.1` 의 주소
- 내 pc에서 localhost로 데이터를 보내면 외부로 나가지 않고 내 pc로 다시 요청이 들어오는 것 (실제 네트워크 계층까지 내려가지 않고 지연시간 없음)

## Network interface

- PC에서 인터넷 혹은 통신을 하려면 wifi나 lan card가 필요
  → 네트워크 인터페이스 (NI)
- OS에서 장치를 인식하면 시스템에 장치마다 대응하는 NI를 각각 만듦
- `ifconfig`, `ipconfig/all` 등의 명령어 사용시 나오는 것이 네트워크 인터페이스

## NI가 있는 이유?

- OS에서 네트워크를 사용하기 위해 장치를 구분하기 위해서 존재
- 원래는 뭔가를 네트워크로 보내려면, 어떤 `NI`로 데이터를 보낼지 정해야 하지만 PC가 IP주소만 보면 어떤 NI를 사용하면 될지 알고 있어 필요가 없었음
  - `192.168.0.0/16` 대역으로 나가려면 `NI2` 번
  - `127.0.0.0/8` 대역으로 나가려면 `NI0` 번
  - `0.0.0.0/0` 그외 모든 대역은 `NI1` 번

위처럼 나가고자 하는 목적지 IP주소에 따라 어떤 `NI`를 사용해야 하는지 OS에서 관리하며, 이것을 `네트워크 라우팅 테이블` 이라고 함

이처럼 하나의 PC에 여러개의 통신 장비가 있더라도, 대역을 통해 망을 구분 가능

그런데, 여러 NI 중에서도 `Loopback NI` 라는게 있습니다

## Loopback NI

이것은 모든 PC에 OS만 설치하면 기본으로 제공 하는 `가상의 장치` 입니다.

실제로 `WIFI`나 `LAN`이 없어도 존재 합니다. 이 장치는 IP주소 중 `127.0.0.0/8` 범위의 요청을 담당하죠.

`127.0.0.0/8` 대역은 IP주소를 정할때부터 애초에 로컬용으로 예약된 대역 입니다.

`127.0.0.1` 은 그 중 첫번째 IP로, 나 자신을 가리킵니다.

그러니까 이 장치는 결국 내가 보내는 내 요청을 받고, 다시 나에게 응답을 돌려주는 통신 장비가 되는 것이고, 내 입이자 내 귀 입니다. `혼잣말` 처럼요.

그리고, 가상의 장치이므로, 물리적인 통신 과정이 생략되어 매우 빠르게 동작 하게 됩니다.

결국, 이 `Loopback NI` 가 있기 때문에 우리가 `localhost` 를 사용할수 있는 것

## localhost 의 간단한 패킷의 흐름

- 앱에서 데이터 전송
  - 웹 브라우저로 [http://127.0.0.1로](http://127.0.0.xn--1-w30f/) 요청을 보내요.
  - 이 요청은 `TCP/IP` 스택을 통해 패킷으로 나가려고 하겠죠?
- `TCP/IP` 스택에서 `IP주소`를 보고 `루프백 NI`로 갑니다.
  - 목적지 주소 `127.0.0.1`을 확인했으니,이제 패킷을 외부로 보내지 않고 로컬로 다시 보냅니다.
- 로컬로 패킷 전달
  - 패킷은 다시 `TCP/IP` 스택 계층으로 전달되고, 올바른 `포트`로 전달됩니다.
- 서버 앱 요청 수신
  - 로컬 서버 앱은 이 요청을 수신하고, 적절한 응답을 생성하여 다시 루프백 인터페이스로 보냅니다.
  - 이 앱은 우리가 만든 `node.js` 앱이나 기타 앱들이 되겠죠?
- 응답 패킷의 루프백 경로
  - 응답 패킷도 동일한 과정을 거쳐 결국, 최종적으로 요청했던 앱인 로컬 브라우저로 전달됩니다.
