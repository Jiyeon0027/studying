## 운영체제의 큰그림

### 시스템 콜

- 운영체제 코드 : 커널 kernel
- 운영체제의 서비스를 제공받기 위한 인터페이스 (호출 가능한 함수 형태)
- 소프트웨어 인터럽트 → cpu의 커널모드 전환 → 운영체제 코드 실행 → 사용자모드 재전환

- 프로세스 및 스레드 관리 (프로세스와 스레드, 동기화와 교착상태)
- 자원할당 및 관리
  - 자원 : 데이터(소프트웨어), 부품(하드웨어)…
  - CPU 스케줄링 - 우선순위, 스케줄링 큐, 선점형과 비선점형
  - 가상메모리 - 물리주소와 논리주소, 메모리 할당, 페이징과 교체 알고리즘
  - 보조기억장치를 효율적으로 관리하기 위해 파일 시스템을 활용

## 프로세스와 스레드

- 실행중인 프로그램 - 프로세스
- 프로세스의 실행단위 : 스레드

### 메모리 영역

- 코드영역 read only - 실행 가능한 명령어가 저장되는 텍스트 영역
- 데이터 영역 : 코드 실행 동안 유지할 데이터 - 전역 변수, 정적 변수
- 힙 영역 : 개발자가 직접 할당 가능한 저장 공간 - 메모리 누수 문제 초래 / 가비지 컬렉션 기능 제공
- 스택 영역: 일시적으로 사용할 값들이 저장 - 매개변수, 지역변수, 함수 복귀 주소
  - 스택 트레이스 형태의 함수 호출정보가 저장

### PCB와 문맥 교환

- Process Control Block : 프로세스 제어 블록
  - 다수의 프로세스 정보를 저장하기 위한 구조체의 일종
    - PID
    - 프로세스 실행 과정에서의 레지스터 값
    - 프로세스 상태
    - CPU 스케줄링(우선순위) 정보
    - 메모리 관련 정보
    - 파일 및 입출력 장치 관련 정보
  - 프로세스 생성시 커널영역에 만들어지고 프로세스의 실행이 끝나면 폐기
  - 프로세스 테이블 형태로 관리
- 프로세스의 실행: 운영체제에 의해 자원을 할당 받았다는 말과 같음
- CPU 실행시간 - 타이머 인터럽트에 의해 제한
  - 사용중인 중간 정보 백업 (PCB에 백업 이후 다시 실행 시 문맥 복구) context switching

### 멀티 프로세스와 멀티 스레드

- 멀티 프로세스 : 각기 다른 작업을 수행하는 여러 프로세스의 실행
  - 독립적으로 실행
- 멀티 스레드 : 프로세스를 동시에 실행하는 여러 스레드
  - 스레드 ID, 프로그램 카운터, 레지스터 값, 스택 등으로 구성
- 멀티스레드와 멀티 프로세스의 가장 큰 차이 : **_자원의 공유 여부_**
  - 프로세스는 독립 실행
  - 스레드는 동일한 주소공간의 코드 ,데이터, 힙영역, 열린파일과 같은 프로세스의 자원을 공유하여 쉽게 협력하고 통신 가능
  - 스레드에서 한 스레드에서 문제가 생기면 전체의 문제가 될 수 있음
- 스레드 조인
  - `join` 스레드를 생성한 주체가 생성/ 실행된 스레드가 종료될때 까지 대기해야함을 의미

### 프로세스 간 통신 IPC(inter-process communication)

- 공유 메모리 방식
  - 데이터를 주고받을 공유 메모리 영역을 지정
  - 마치 자신의 메모리 영역을 읽고 쓰는 것처럼 통신 - 빠른 속도
  - 데이터의 일관성이 훼손 될 수 있다는 단점 - 레이스 컨디션
- 메시지 전달 방식
  - 프로세스 간에 데이터를 메시지 형태로 주고 받는 방식
  - `send()`, `recv()` 시스템 콜을 호출하며 메시지를 송수신
  - 파이프 : 단방향 프로세스 간의 통신 도구 (읽기용, 쓰기용)
    - 익명 파이프 vs 지명 파이프
      익명 파이프 - 단방향 통신 수단인 전통적인 파이프로 양방향 통신을 지원하지 않고 부모 프로세스와 자식 프로세스 간에만 통신이 가능하다는 한계
      지명 파이프 (named pipe) : FIFO - 양방향 통신을 지원하며 임의의 프로세스 간에도 사용이 가능
  - 시그널 : 프로세스에게 특정 이벤트가 발생했음을 알리는 비동기적인 신호
    - `SIGHLCD, SIGILL, SIFINT, SIGKILL, SIGSEGV, SIGTERM, SIGUSER`
    - 시그널이 발생하면 인터럽트 처리과정과 유사하게 하던일을 중단하고 시그널 핸들러를 실행후 다시 재개 - 코어 덤프를 생성하여 특정 시점에 작업하던 메모리 상태 기록
  - 원격 프로시저 호출 (RPC) , 네트워크 소켓을 통해 IPC 수행
    - 원격 프로시저 호출
      - 다른 프로세스의 함수나 프로시저를 실행 할 수 있는 원격 코드 호출
      - 프로그래밍 언어나 환경에 구애받지 않고 메소드 호출처럼 진행
      - 메시지 송수신이 간으해 대규모 트래픽 처리환경, 특히 서버 간 통신 환경에서 사용

## 동기화와 교착상태

- 공유 자원 : 프로세스나 스레드가 공유하는 자원 (메모리, 파일, 전역변수, 입출력장치…)
- 임계 구역 : 공유자원에 접근하는 코드 중 동시에 실행했을때 문제가 발생할 수 있는 코드
  - 실행이 동시에 되거나 실행 도중에 문맥교환이 발생하면 문제가 발생할 수 있는 구역이 임계구역
  - 스레드가 동시에 임계구역의 코드를 실행하며 문제가 발생하는 상황 : 레이스 컨디션
- 이러한 레이스 컨디션을 방지하면서 임계 구역을 관리하기 위해 동기화가 필요
